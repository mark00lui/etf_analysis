# 元大ETF數據抓取系統

## 功能說明

本系統可以自動抓取元大投信所有ETF產品的持股數據並保存到MongoDB數據庫中。

## 支持的ETF產品

- 0050 - 元大台灣卓越50基金
- 0051 - 元大中型100基金
- 0053 - 元大電子基金
- 0055 - 元大MSCI金融基金
- 0056 - 元大高股息基金
- 006201 - 元大富櫃50基金
- 006203 - 元大MSCI台灣ESG永續基金
- 00713 - 元大台灣高息低波基金
- 00850 - 元大台灣ESG永續基金
- 00940 - 元大台灣價值高息基金

## 使用方法

### 1. 抓取所有ETF數據

```bash
python yuanta_etf_scraper.py
```

### 2. 檢查MongoDB狀態

```bash
python mongodb_manager.py
```

### 3. 查詢特定ETF數據

```python
from mongodb_manager import query_etf_data
query_etf_data('0050', 10)  # 查詢0050的前10名持股
```

## 數據結構

### MongoDB集合: holdings

```json
{
  "etf_ticker": "0050",
  "date": "2025-09-05",
  "stock_code": "2330",
  "stock_name": "台積電",
  "shares": 333314781,
  "weight": 58.75,
  "market_value": 0.0,
  "created_at": "2025-09-08T14:24:00.226000"
}
```

## 系統要求

- Python 3.7+
- Chrome瀏覽器
- MongoDB數據庫
- 網路連接

## 依賴項

```bash
pip install -r requirements.txt
```

## 日誌

系統運行日誌保存在 `logs/yuanta_scraper.log` 文件中。

## 重複數據防護

系統內建智能重複檢查機制：

### 檢查邏輯
- **ETF + 日期檢查**: 如果相同ETF在相同日期已有數據，會跳過寫入
- **詳細數據比較**: 比較股票代碼、名稱、權重、持股數是否完全相同
- **強制更新選項**: 可選擇強制覆蓋現有數據

### 使用場景
- **週末/週一運行**: 避免重複抓取週五的收盤數據
- **多次運行**: 防止意外重複執行造成的數據重複
- **數據更新**: 需要時可強制更新數據

### 日誌輸出
```
ETF 0050 重複檢查: 數據完全相同，跳過寫入
ETF 0050 在 2025-09-05 的數據已存在 (50 筆)，跳過寫入
```

## 注意事項

1. 系統使用無頭模式運行Chrome瀏覽器
2. 預設不會覆蓋同一天的數據（防重複機制）
3. 建議在非交易時間運行以避免網站負載
4. 確保MongoDB服務正在運行
5. 如需強制更新數據，可修改代碼中的 `force_update=True`